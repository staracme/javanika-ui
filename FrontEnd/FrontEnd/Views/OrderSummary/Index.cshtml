
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model FrontEnd.Models.tblTicketOrder

@{
    FrontEnd.Models.JAVADBEntities db = new FrontEnd.Models.JAVADBEntities();

    var evt = db.tblEvents.Where(e => e.EventID == Model.EventID).SingleOrDefault();
}


<script src="https://www.paypal.com/sdk/js?client-id=AYZg72OmfeJnm88ghZQv7x4opaln2jZ1k6uHnhIYOaMl_RUPLGbutIGi0Gsp8b8NogkMEQuVbj5NBgvX">
</script>

@*
    <script src="https://www.paypal.com/sdk/js?client-id=AW3y6TJ_eeCUe4f0X1BT33IR2EuHy2IzWuAsHFWtKcoZJd3OsVDZkV3qPvS6J2NUp5JjWSjBxcihAFuU">
    </script>
*@
<script type="text/javascript">
    function OverridePP() {
        debugger;
        $.ajax({
            url: '/OrderSummary/PlaceOrder',
            type: "POST",
            data: {
                orderID: 'override-paypal-id',
                sys_orderID: @Model.OrderID,
                email: '@Model.Email',
                name: '@Model.Name',
                eventID: @Model.EventID,
                amount: -1,
                intent: 'CAPTURE',
                status: 'COMPLETED',
                no_of_tickets: '@Model.NoOfTickets'
            },
            success: function (response) {
                if(response.status == "OK") {
                    location.href = "/OrderSuccess?orderID=@Model.OrderID";

    			}
            }
        });
    }
</script>
<script type="text/javascript">
    paypal.Buttons({
        createOrder: function (data, actions) {
    			// Set up the transaction
            debugger;
    			return actions.order.create({
    				headers: {
    					'Content-Type': 'application/json',
    				},
    				purchase_units: [{
    					amount: {
    						value: '@Decimal.Round(Convert.ToDecimal(ViewData["Amount"].ToString()),2)'
    					}
    				}]
    			});

        },
        onApprove: function (data, actions) {
            $("#divLoading").show();
            debugger;

            // Capture the funds from the transaction
            return actions.order.capture().then(function (details) {
                // Show a success message to your buyer


                $.ajax({
                    url: '/OrderSummary/PlaceOrder',
                    type: "POST",
                    data: {
                        orderID: data.orderID,
                        sys_orderID: @Model.OrderID,
                        email: '@Model.Email',
                        name: '@Model.Name',
                        eventID: @Model.EventID,
                        amount: details.purchase_units[0].amount.value,
                        intent: details.intent,
                        status: details.status,
                        no_of_tickets: '@Model.NoOfTickets'
                    },
                    success: function (response) {
                        if(response.status == "OK") {
                          location.href = "/OrderSuccess?orderID=@Model.OrderID";

    					}
                    }
                });
            });
        }
    }).render('#pp');

</script>

<div class="ContentWrap">
    <div class="MainInnerLabel">Your Order Summary</div>

    <div class="OrderSumWrap">
        <table border="1" class="ordTbl">
            <tr>
                <th>Show Details</th>
                <th>Total Tickets</th>
                <th>Sub Total</th>
            </tr>
            <tr>
                <td>
                    <div class="ShowName">@evt.EventName</div>
                </td>
                <td>
                    <div class="ShowTier">@Model.NoOfTickets</div>
                </td>
                <td>
                    <div class="ShowSeat">
                        @Model.Amount
                </div>
            </td>
        </tr>
    </table>
    <div class="OrdTot">

        <div class="TotalOrdBlock">
            <div class="TotOrdLeft">Final Amount:</div>
            <div class="TotOrdRight">$@Decimal.Round(Convert.ToDecimal(ViewData["Amount"].ToString()), 2)</div>
            <div class="clr"></div>
        </div>
        <div class="TotalOrdBlock">
            <div class="TotOrdLeft">Processing Fee:</div>
            <div class="TotOrdRight">$@Decimal.Round(Convert.ToDecimal(ViewData["ProcessingFee"].ToString()), 2) (@ViewData["ProcessingPercentage"]%)</div>
            <div class="clr"></div>
        </div>

        <div class="TotalOrdBlock">
            <div class="TotOrdLeft">Total Amount:</div>
            <div class="TotOrdRight">$@Model.Amount</div>
            <div class="clr"></div>
        </div>

        <div class="clr"></div>
    </div>

    <div class="OrdBtn">
        <div id="pp"></div>
    </div>
    <div>
        <button type="button" onclick="JavaScript: OverridePP();"
                class="button-62" id="but_upload">
            Override PayPal Payment
        </button>
    </div>
</div>

</div>

<div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px; top: 0px; width: 100%; height: 100%; background-color: rgb(102, 102, 102); z-index: 30001; opacity: 0.8;display:none;">
    <p style="position: absolute; color: White; top: 50%; left: 45%;">
        Loading, please wait...
        <img src="../App_Images/indicator-big.gif">
    </p>
</div>
